___
- FileName: 20181220-nc命令和nmap命令.md
- Author: ihuangch -huangch96@qq.com
- Description: ---
- Create:2018-12-20 18:32:44
___

### 0. 背景
工作中经常需要使用的跳板机，我们使用者就只有一个跳板机的密钥，就可以通过跳板机登录所有的主机，
然而在工作中经常需要多个主机之间传输文件之类的操作，此时又没有单独的密钥和密码传输文件，这时
就想到了nc命令这个小工具，在此做个总结。顺便把和nc齐名的nmap工具一起总结一下。

### 1. nc命令
NetCat是在一些发行版就是nc命令。  
它能通过TCP和UDP在网络中读写数据，通过与其它工具结合和重定向，可以在脚本中以多种方式使用它。  

##### 1.1 主要功能

- 实现任意TCP/UDP端口的侦听，nc可以作为server以tcp/upd方式侦听端口
- 端口的扫描，nc作为client发起TCP/UDP连接
- 机器之间传输文件
- 机器之间测试网速

Ncat是CentOS7默认的nc命令，CentOS6默认的原始nc命令  

##### 1.2 安装nc命令:  
```
yum install nc

```

##### 1.3 使用方法
```
注意：nc版本不一样，或者开发厂商不一样，选项会有不同
下面展示的是基本的一些选项和参数
[root@centos-111 ~]# nc -h
usage: nc [-46DdhklnrStUuvzC] [-i interval] [-p source_port]
	      [-s source_ip_address] [-T ToS] [-w timeout] [-X proxy_version]
	  	  [-x proxy_address[:port]] [hostname] [port[s]]
	Command Summary:
		-4		Use IPv4
		-6		Use IPv6
		-D		Enable the debug socket option
				打开socker选项进行调试
		-d		Detach from stdin
				从标准输入中分离(不从标准输入读取数据)
		-h		This help text
		-i secs		Delay interval for lines sent, ports scanned
				间隔时间，在发送和接收之间指定一个间隔时间(会引起连接多个接口时的延迟)
		-k		Keep inbound sockets open for multiple connects
				
		-l		Listen mode, for inbound connects
				监听模式，指定-l则为server模式
		-n		Suppress name/port resolutions
				不使用域名解析
		-p port		Specify local port for remote connects
				指定端口
		-r		Randomize remote ports
		-S		Enable the TCP MD5 signature option
		-s addr		Local source address
				指定本机地址，适合多网卡
		-T ToS		Set IP Type of Service
		-C		Send CRLF as line-ending
		-t		Answer TELNET negotiation
		-U		Use UNIX domain socket
		-u		UDP mode
				使用UDP模式
		-v		Verbose
				输出更加详细的信息
		-w secs		Timeout for connects and final net reads
				超时秒数
		-X proto	Proxy protocol: "4", "5" (SOCKS) or "connect"
		-x addr[:port]	Specify proxy address and port
		-z		Zero-I/O mode [used for scanning]
				0 I/O，扫描的时候不发送任何数据
	Port numbers can be individual or ranges: lo-hi [inclusive]
```

##### 1.4 客户端/服务器模式
```
[root@centos-112 ~]# nc -l 9900
Hello World --112 is server      
NiHao       --111 is client

上面所有内容都是自己发送的，服务端为112，客户端为111机器
[root@centos-111 ~]# nc 192.168.56.112 9900
Hello World --112 is server
NiHao       --111 is client

```

##### 1.5 传输文件
```
方式1
跨主机copy文件，首先在dest主机，开启监听模式
以下演示从112主机copy 测试文件至111主机
dest设置为服务端
[root@centos-111 ~]# nc -l 1234 > from112.test
[root@centos-111 ~]# cat from112.test 
This is a File Src=112

[root@centos-112 ~]# nc 192.168.56.111 1234 < centos112.test 
[root@centos-112 ~]# cat centos112.test 
This is a File Src=112

方式2
首先在src主机，开启监听模式
以下演示从111主机copy 测试文件至112主机
src设置为服务端
[root@centos-111 ~]# nc -l 1234 < centos111.test 
^C
You have new mail in /var/spool/mail/root
[root@centos-111 ~]# cat centos111.test 
This is a file src=111

[root@centos-112 ~]# nc 192.168.56.111 1234 > from111.test
^C
You have new mail in /var/spool/mail/root
[root@centos-112 ~]# cat from111.test 
This is a file src=111

注意这里nc命令并没有自动退出, 需要手动Ctrl+C退出

总之无论哪一方作为服务端，copy文件dest端的重定向符号为 >

```

###### 1.6 目录传输
```
如果需要发送多个文件，或者整个目录，需要使用压缩工具tar，压缩后发送压缩包
首先创建目录和文件
src端进行监听，充当server端
[root@centos-111 ~]# touch centos111test/centos111.test{0..9}

[root@centos-111 ~]# tar cvf - centos111test/ | nc -l 1234
centos111test/
centos111test/centos111.test8
centos111test/centos111.test6
centos111test/centos111.test1
centos111test/centos111.test3
centos111test/centos111.test4
centos111test/centos111.test7
centos111test/centos111.test9
centos111test/centos111.test0
centos111test/centos111.test2
centos111test/centos111.test5

[root@centos-112 ~]# nc 192.168.56.111 1234 | tar xvf -
centos111test/
centos111test/centos111.test8
centos111test/centos111.test6
centos111test/centos111.test1
centos111test/centos111.test3
centos111test/centos111.test4
centos111test/centos111.test7
centos111test/centos111.test9
centos111test/centos111.test0
centos111test/centos111.test2
centos111test/centos111.test5
^C
[root@centos-112 ~]# ll centos111test/
total 0
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test0
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test1
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test2
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test3
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test4
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test5
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test6
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test7
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test8
-rw-r--r-- 1 root root 0 Dec 23 15:00 centos111.test9

```

##### 1.7 克隆设备
```
克隆单独的一块硬盘，通过dd命令，从磁盘读取原始数据，通过nc服务器重定向它的输出流到其它机器，
并且写入到磁盘中，会随着分区表拷贝所有的信息
[root@centos-111 ~]# dd if=/dev/sda | nc -l 1234

[root@centos-112 ~]# nc 192.168.56.111 | dd of=/dev/sda 
```

##### 1.8 打开一个shell
```
这里有两种方式，主要时因为nc开发商不通的原因，有些存在特别的选项
1. nc增强版开通shell
server:
nc -l 1234 -e /bin/bash -i 
client:
nc 192.168.56.111 1234 
注意: 并没有测试

2. nc轻量版开通shell
server:
[root@centos-111 ~]# mkfifo /tmp/tmp_fifo
[root@centos-111 ~]# cat /tmp/tmp_fifo | /bin/sh -i 2>&1 | nc -l 1234 > /tmp/tmp_fifo 
client:
[root@centos-112 ~]# nc 192.168.56.111 1234
sh-4.1# ls
ls
123.txt
anaconda-ks.cfg
a.txt
centos111test
centos111.test

说明：


```
