___
- FileName: 20190103-sudo和sudoers文件的企业级跳板机配置思路.md
- Author: ihuangch -huangch96@qq.com
- Description: ---
- Create:2019-01-03 20:30:18
___

### 背景
公司大概有4000+的机器，这些机器都不可以使用密码进行登录，只有使用密钥通过跳板机进行登录。
每个用户通过自己的用户名和密钥进行登录跳板机，通过跳板机登录到目标机器，目标机器的用户
分为开发和运维两类。每个开发同事只能通过跳板机使用公用的开发账号，登入到目标主机，进行相应
的操作。此时对于账号的sudo和跳板机sudo的关机就是很必要的了。

### sudo 使用
sudo 命令是Linux上的一个非常有用的工具，它允许系统管理员分配给普通用户一些合理的"权限"，让
他们执行一些只用root用户或其它特许用户才能完成的任务，比如：运行一些mount，reboot，su等命令，
编辑一些系统配置文件等。这样就会减少了root用户的登录次数和管理时间，也提高了系统安全性。

#### sudo 命令的特点
- sudo能够限制指定用户在指定主机上运行某些命令
- sudo可以提供日志，忠实的记录每个用户使用sudo做了些什么，并且能够将日志传到中心主机或者日志服务器
- sudo为系统管理员提供配置文件，允许系统管理员集中的管理用户的使用权限和使用的主机。默认的存放位置/etc/sudoers
- sud使用时间戳文件来完成类似"检票"的系统。当用户执行sudo并且输入密码后，用户获得了一张默认存活期为300秒的"入场券"(默认值可以在编译的时候改变)。超时以后，用户必须重新输入密码。

#### sudo 执行命令的过程
将当前用户切换到超级用户下，或者切换到指定的用户下。然后以超级用户或其指定切换到的用户身份
执行命令，执行完成后，直接退回到当前用户。  
具体过程:  
- 当用户执行sudo时，系统会主动寻找/etc/sudoers文件，判断该用户是否有执行sudo的权限
- 确认用户具有可执行的sudo权限后，让用户输入自己的密码确认
- 密码输入成功，则开始执行sudo后续的命令


#### 不需要输入密码的情况
- root执行sudo时不需要输入密码(sudoers文件中有配置root ALL=(ALL) ALL这样一条规则)
- 欲切换的身份和执行者的身份相同，不需要输入密码
- /etc/sudoers文件设置为允许用户在不输入该用户的密码的情况下使用所有命令(%wheel ALL=(ALL) NOPASSWD:ALL)


