___
- FileName: 20181229-MySQL查询缓存.md
- Author: ihuangch -huangch96@qq.com
- Description: ---
- Create:2018-12-29 14:26:09
___

### 查询缓存
**注意**:
从MySQL 5.7.20开始，不推荐使用查询缓存，并在MySQL 8.0中删除。  
from Mysql官方文档  

MySQL Query Cache是用来缓存我们执行select语句以及该语句的结果集，MySQL在实现Query Cache的具体
技术细节上类似典型的KV存储，就是将SELECT语句和该查询语句的结果做了一个HASH映射并保存在一定的
内存区域中。当客户端发起SQL查询时，Query Cache的查找逻辑是:
- 先对SQL进行相应的权限验证
- 然后通过Query Cache来查找结果
注意必须是完全相同，即使多一个空格或者大小写不同都认为不同，即使完全相同的SQL，如果使用不同的
字符集，不同的协议等也会被认为是不同的查询而分别进行缓存。  
它不需要警告Optimizer模块进行执行计划的分析优化，更不需要发送同任何存储引擎的交互，减少了大量
的磁盘IO和CPU运算，所以有时候效率非常高。  
```mysql
SELECT * FROM tbl_name
Select * from tbl_name
```
这样同样无法使用查询缓存。
##### 哪些查询不会被缓存
- 缓存存在一个hash表中，通过查询SQL，查询数据库，客户端协议等作为key，在判断是否命中前，MySQL
不会解析SQL，而是直接使用SQL去查询缓存，SQL任何字符上的不同，如空格，注释都回导致缓存不命中
- 查询中有不确定的数据，如CURRENT_DATE()和NOW()函数，那么查询完毕后则不会被缓存
- 查询时外部查询的子查询
- 在存储的函数，触发器或者事件的主体内执行的查询
- 用户定义的函数(UDF)或存储函数
- 用户变量或本地存储的程序变量
- 表mysql,INFORMATION_SCHEMA或performance_schema数据库


### 缓存相关的服务器变量

